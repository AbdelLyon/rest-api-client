{"version":3,"file":"Auth.es.js","sources":["../../src/auth/Auth.ts"],"sourcesContent":["import type { IAuth } from \"./interface/IAuth\";\nimport type { RequestConfig } from \"@/http/types/http\";\nimport { z } from \"zod\";\nimport { HttpClient } from \"../http/HttpClient\";\n\n\nexport abstract class Auth<\n   UserType extends object = {},\n   CredentialsType extends object = {},\n   RegisterDataType extends object = {},\n   TokenType extends object = {}\n> implements IAuth<UserType, CredentialsType, RegisterDataType, TokenType> {\n   protected http: HttpClient;\n   protected pathname: string;\n   protected userSchema: z.ZodType<UserType>;\n   protected credentialsSchema?: z.ZodType<CredentialsType>;\n   protected registerDataSchema?: z.ZodType<RegisterDataType>;\n   protected tokenSchema?: z.ZodType<TokenType>;\n\n   constructor (\n      pathname: string,\n      schemas: {\n         user: z.ZodType<UserType>;\n         credentials?: z.ZodType<CredentialsType>;\n         registerData?: z.ZodType<RegisterDataType>;\n         tokens?: z.ZodType<TokenType>;\n      }\n   ) {\n      this.http = HttpClient.getInstance();\n      this.pathname = pathname;\n      this.userSchema = schemas.user;\n      this.credentialsSchema = schemas.credentials;\n      this.registerDataSchema = schemas.registerData;\n      this.tokenSchema = schemas.tokens;\n   }\n\n   public async register(\n      userData: RegisterDataType,\n      options: Partial<RequestConfig> = {}\n   ): Promise<UserType> {\n      if (this.registerDataSchema) {\n         this.registerDataSchema.parse(userData);\n      }\n\n      try {\n         const response = await this.http.request<{\n            user: UserType;\n            tokens: TokenType;\n         }>({\n            method: 'POST',\n            url: `${this.pathname}/register`,\n            data: userData\n         }, options);\n\n         const user = this.userSchema.parse(response.user);\n         if (this.tokenSchema) {\n            this.tokenSchema.parse(response.tokens);\n         }\n\n         return user;\n      } catch (error) {\n         console.error('Registration error', error);\n         throw error;\n      }\n   }\n\n   public async login(\n      credentials: CredentialsType,\n      options: Partial<RequestConfig> = {}\n   ): Promise<{\n      user: UserType;\n      tokens: TokenType;\n   }> {\n      if (this.credentialsSchema) {\n         this.credentialsSchema.parse(credentials);\n      }\n\n      try {\n         const response = await this.http.request<{\n            user: UserType;\n            tokens: TokenType;\n         }>({\n            method: 'POST',\n            url: `${this.pathname}/login`,\n            data: credentials\n         }, options);\n\n         const user = this.userSchema.parse(response.user);\n         const tokens = this.tokenSchema ? this.tokenSchema.parse(response.tokens) : response.tokens;\n\n         return { user, tokens };\n      } catch (error) {\n         console.error('Login error', error);\n         throw error;\n      }\n   }\n\n   public async logout(\n      options: Partial<RequestConfig> = {}\n   ): Promise<void> {\n      try {\n         await this.http.request({\n            method: 'POST',\n            url: `${this.pathname}/logout`\n         }, options);\n      } catch (error) {\n         console.error('Logout error', error);\n         throw error;\n      }\n   }\n\n   public async refreshToken(\n      refreshToken: string,\n      options: Partial<RequestConfig> = {}\n   ): Promise<TokenType> {\n      try {\n         const response = await this.http.request<TokenType>({\n            method: 'POST',\n            url: `${this.pathname}/refresh-token`,\n            data: { refreshToken }\n         }, options);\n\n         // Validation du schéma des tokens si défini\n         return this.tokenSchema ? this.tokenSchema.parse(response) : response;\n      } catch (error) {\n         console.error('Token refresh error', error);\n         throw error;\n      }\n   }\n\n   public async getCurrentUser(\n      options: Partial<RequestConfig> = {}\n   ): Promise<UserType> {\n      try {\n         const response = await this.http.request<UserType>({\n            method: 'GET',\n            url: `${this.pathname}/me`\n         }, options);\n\n         return this.userSchema.parse(response);\n      } catch (error) {\n         console.error('Get current user error', error);\n         throw error;\n      }\n   }\n};"],"names":["Auth","pathname","schemas","__publicField","HttpClient","userData","options","response","user","error","credentials","tokens","refreshToken"],"mappings":";;;;AAMO,MAAeA,EAKqD;AAAA,EAQxE,YACGC,GACAC,GAMD;AAfQ,IAAAC,EAAA;AACA,IAAAA,EAAA;AACA,IAAAA,EAAA;AACA,IAAAA,EAAA;AACA,IAAAA,EAAA;AACA,IAAAA,EAAA;AAWF,SAAA,OAAOC,EAAW,YAAY,GACnC,KAAK,WAAWH,GAChB,KAAK,aAAaC,EAAQ,MAC1B,KAAK,oBAAoBA,EAAQ,aACjC,KAAK,qBAAqBA,EAAQ,cAClC,KAAK,cAAcA,EAAQ;AAAA,EAAA;AAAA,EAG9B,MAAa,SACVG,GACAC,IAAkC,IAChB;AAClB,IAAI,KAAK,sBACD,KAAA,mBAAmB,MAAMD,CAAQ;AAGrC,QAAA;AACD,YAAME,IAAW,MAAM,KAAK,KAAK,QAG9B;AAAA,QACA,QAAQ;AAAA,QACR,KAAK,GAAG,KAAK,QAAQ;AAAA,QACrB,MAAMF;AAAA,SACNC,CAAO,GAEJE,IAAO,KAAK,WAAW,MAAMD,EAAS,IAAI;AAChD,aAAI,KAAK,eACD,KAAA,YAAY,MAAMA,EAAS,MAAM,GAGlCC;AAAA,aACDC,GAAO;AACL,oBAAA,MAAM,sBAAsBA,CAAK,GACnCA;AAAA,IAAA;AAAA,EACT;AAAA,EAGH,MAAa,MACVC,GACAJ,IAAkC,IAIlC;AACA,IAAI,KAAK,qBACD,KAAA,kBAAkB,MAAMI,CAAW;AAGvC,QAAA;AACD,YAAMH,IAAW,MAAM,KAAK,KAAK,QAG9B;AAAA,QACA,QAAQ;AAAA,QACR,KAAK,GAAG,KAAK,QAAQ;AAAA,QACrB,MAAMG;AAAA,SACNJ,CAAO,GAEJE,IAAO,KAAK,WAAW,MAAMD,EAAS,IAAI,GAC1CI,IAAS,KAAK,cAAc,KAAK,YAAY,MAAMJ,EAAS,MAAM,IAAIA,EAAS;AAE9E,aAAA,EAAE,MAAAC,GAAM,QAAAG,EAAO;AAAA,aAChBF,GAAO;AACL,oBAAA,MAAM,eAAeA,CAAK,GAC5BA;AAAA,IAAA;AAAA,EACT;AAAA,EAGH,MAAa,OACVH,IAAkC,IACpB;AACV,QAAA;AACK,YAAA,KAAK,KAAK,QAAQ;AAAA,QACrB,QAAQ;AAAA,QACR,KAAK,GAAG,KAAK,QAAQ;AAAA,SACrBA,CAAO;AAAA,aACJG,GAAO;AACL,oBAAA,MAAM,gBAAgBA,CAAK,GAC7BA;AAAA,IAAA;AAAA,EACT;AAAA,EAGH,MAAa,aACVG,GACAN,IAAkC,IACf;AACf,QAAA;AACD,YAAMC,IAAW,MAAM,KAAK,KAAK,QAAmB;AAAA,QACjD,QAAQ;AAAA,QACR,KAAK,GAAG,KAAK,QAAQ;AAAA,QACrB,MAAM,EAAE,cAAAK,EAAa;AAAA,SACrBN,CAAO;AAGV,aAAO,KAAK,cAAc,KAAK,YAAY,MAAMC,CAAQ,IAAIA;AAAA,aACvDE,GAAO;AACL,oBAAA,MAAM,uBAAuBA,CAAK,GACpCA;AAAA,IAAA;AAAA,EACT;AAAA,EAGH,MAAa,eACVH,IAAkC,IAChB;AACd,QAAA;AACD,YAAMC,IAAW,MAAM,KAAK,KAAK,QAAkB;AAAA,QAChD,QAAQ;AAAA,QACR,KAAK,GAAG,KAAK,QAAQ;AAAA,SACrBD,CAAO;AAEH,aAAA,KAAK,WAAW,MAAMC,CAAQ;AAAA,aAC/BE,GAAO;AACL,oBAAA,MAAM,0BAA0BA,CAAK,GACvCA;AAAA,IAAA;AAAA,EACT;AAEN;"}