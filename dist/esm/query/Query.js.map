{"version":3,"file":"Query.js","sources":["../../../src/query/Query.ts"],"sourcesContent":["import type { BaseHttp } from \"../http/shared/BaseHttp\";\nimport type { z } from \"zod\";\nimport type {\n  PaginatedSearchRequest,\n  SearchRequest,\n  SearchResponse,\n} from \"@/query/types/search\";\nimport type { DetailsResponse } from \"@/query/types/details\";\nimport type { IQuery } from \"@/query/interface/IQuery\";\nimport type { RequestConfig } from \"@/http/types/http\";\nimport { HttpClient } from \"@/http/HttpClient\";\n\nexport abstract class Query<T> implements IQuery<T> {\n  protected http: BaseHttp;\n  protected pathname: string;\n  protected schema: z.ZodType<T>;\n\n  constructor(\n    pathname: string,\n    schema: z.ZodType<T>,\n    httpInstanceName?: string,\n  ) {\n    this.http = HttpClient.getInstance(httpInstanceName);\n    this.pathname = pathname;\n    this.schema = schema;\n  }\n\n  private validateData(data: Array<unknown>): Array<T> {\n    return data.map((item) => {\n      const result = this.schema.safeParse(item);\n      if (!result.success) {\n        console.error(\"Type validation failed:\", result.error.errors);\n        throw new Error(\n          `Type validation failed: ${JSON.stringify(result.error.errors)}`,\n        );\n      }\n      return result.data;\n    });\n  }\n\n  private searchRequest(\n    search: SearchRequest,\n    options: Partial<RequestConfig> = {},\n  ): Promise<SearchResponse<T>> {\n    return this.http.request<SearchResponse<T>>(\n      {\n        method: \"POST\",\n        url: `${this.pathname}/search`,\n        data: { search },\n      },\n      options,\n    );\n  }\n\n  public async search(\n    search: SearchRequest,\n    options: Partial<RequestConfig> = {},\n  ): Promise<Array<T>> {\n    const response = await this.searchRequest(search, options);\n    return this.validateData(response.data);\n  }\n\n  public async searchPaginate(\n    search: PaginatedSearchRequest,\n    options: Partial<RequestConfig> = {},\n  ): Promise<SearchResponse<T>> {\n    const response = await this.searchRequest(search, options);\n\n    return {\n      ...response,\n      data: this.validateData(response.data),\n    };\n  }\n\n  public getdetails(\n    options: Partial<RequestConfig> = {},\n  ): Promise<DetailsResponse> {\n    return this.http.request<DetailsResponse>(\n      {\n        method: \"GET\",\n        url: this.pathname,\n      },\n      options,\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAYO,MAAe,MAA8B;AAAA,EAKlD,YACE,UACA,QACA,kBACA;AARQ;AACA;AACA;AAOH,SAAA,OAAO,WAAW,YAAY,gBAAgB;AACnD,SAAK,WAAW;AAChB,SAAK,SAAS;AAAA,EAAA;AAAA,EAGR,aAAa,MAAgC;AAC5C,WAAA,KAAK,IAAI,CAAC,SAAS;AACxB,YAAM,SAAS,KAAK,OAAO,UAAU,IAAI;AACrC,UAAA,CAAC,OAAO,SAAS;AACnB,gBAAQ,MAAM,2BAA2B,OAAO,MAAM,MAAM;AAC5D,cAAM,IAAI;AAAA,UACR,2BAA2B,KAAK,UAAU,OAAO,MAAM,MAAM,CAAC;AAAA,QAChE;AAAA,MAAA;AAEF,aAAO,OAAO;AAAA,IAAA,CACf;AAAA,EAAA;AAAA,EAGK,cACN,QACA,UAAkC,IACN;AAC5B,WAAO,KAAK,KAAK;AAAA,MACf;AAAA,QACE,QAAQ;AAAA,QACR,KAAK,GAAG,KAAK,QAAQ;AAAA,QACrB,MAAM,EAAE,OAAO;AAAA,MACjB;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAAA,EAGF,MAAa,OACX,QACA,UAAkC,IACf;AACnB,UAAM,WAAW,MAAM,KAAK,cAAc,QAAQ,OAAO;AAClD,WAAA,KAAK,aAAa,SAAS,IAAI;AAAA,EAAA;AAAA,EAGxC,MAAa,eACX,QACA,UAAkC,IACN;AAC5B,UAAM,WAAW,MAAM,KAAK,cAAc,QAAQ,OAAO;AAElD,WAAA;AAAA,MACL,GAAG;AAAA,MACH,MAAM,KAAK,aAAa,SAAS,IAAI;AAAA,IACvC;AAAA,EAAA;AAAA,EAGK,WACL,UAAkC,IACR;AAC1B,WAAO,KAAK,KAAK;AAAA,MACf;AAAA,QACE,QAAQ;AAAA,QACR,KAAK,KAAK;AAAA,MACZ;AAAA,MACA;AAAA,IACF;AAAA,EAAA;AAEJ;"}